## 系统消息

## 系统通知的未读数要如何设计
    
1. 原始方式
    通过获取用户列表，每个用户通过key做一个计数；做一个全量用户数的计算
``` shell
List<Long> userIds = getAllUserIds()
for (long id : userIds) {
    incrUnreadCount(id);
}
```
    获取全量用户比较耗时，需要做全表扫描
    处理时间过长

1. 实现方式
    所有用户共享同一个消息列表
    通过每个用户记录一个时间戳，然后消息会有个全局时间戳；判断用户的时间戳是否小于全局时间戳，小于则说明有消息
    

## 如何为信息流设置未读数
    1. 通过redis记录所有人发送信息的数据量
    1. 记录每个人关注的消息的快照，这样通过关注人总数-当前快照数量就可以看到；关注人有多少信息差
        这里问题有个问题关注人变更或者消息需要做相应的操作
