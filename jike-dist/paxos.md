# paxos

## Paxos算法（一）：如何在多个节点间确定某变量的
1. 角色
    提议者 接受者 学习者

### 如何达成共识
    2阶段提交
1. 准备阶段 prepare
    准备请求:
    若不小于等于或无提案之前响应的提案编号则返回一个准备响应-尚无提案;并承若不响应小于等于xx的准备请求；不通过编号小于的xx的提案
    若小于等于，丢弃准备请求不做响应 (会导致提议者接收不到准备请求的响应)
1. 接受阶段 accept
    提议者发送提案和提议值
    小于的则提案拒绝，不小于则通过相关提案，达成共识

    一半的节点出现故障的时候，共识协商仍然在正常工作

1. 根据提案编号的大小，接受者保证三个承诺
    1. 如果准备请求的提案编号，小于等于接受者已经响应的准备请求的提案编号，那么接受者将承诺不响应这个准备请求
    1. 如果接受请求中的提案的提案编号，小于接受者已经响应的准备请求的提案编号，那么接受者将承诺不通过这个提案
    1. 如果接受者之前有通过提案，那么接受者将承诺，会在准备请求的响应中，包含已经通过的最大编号的提案信息
        更新提案编号（取最大值）; 让提案编号最大的得利
    

## Paxos算法（二）：Multi-Paxos不是一个算法，而是统称
    兰伯特提到的 Multi-Paxos 是一种思想，不是算法
    而Multi-Paxos 算法是一个统称，它是指基于 Multi-Paxos 思想，通过basic paxos实例实现一系列值的共识算法（chubby的multi-paxos实现、raft算法） 

1. basic paxos实现一系列值的共识存在问题
    提案冲突概率提高，需要继续； 提议者会首先给自己投一票
    2轮rpc，准备阶段和接受阶段，往返消息多、耗性能、延迟大

1. 通过引入领导者和优化basic paxos执行来解决

### 角色
    领导者leader

### 领导者
    领导者节点为唯一提议者
    在chubby中，主节点是通过执行basic paxos算法进行投票选举产生的

### 优化basic paxos执行
    当领导者处于稳定状态，省掉准备阶段直接进入接受阶段
    领导者节点上，序列中的命令是最新的

    主节点会通过不断续租的方式来延长租期lease，在实际场景中几天内都是同一个节点作为主节点,如果主节点故障了，那么其他的节点又会投票选举出新的主节点，也就是说主节点是一直存在的，而且是唯一的

    成员变更，保证节点变更时集群平稳运行
    在chubby中，为了实现强一致性，读操作只能在主节点执行
