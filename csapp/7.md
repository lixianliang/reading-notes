# 7

## 静态链接
    将一组可重定位目标文件生成可以加载和运行可执行目标文件

## 目标文件的理解
1.  可重定位目标文件

    包含代码和数据但不能直接运行，比如点o文件

1. 可执行文件

    包含二进制代码和数据，可以直接运行

1. 共享目标文件

    也是可重定位目标文件，可以在程序加载或者运行时，被动态的加载到存储器并链接；多个进程可以共享同一个共享库节省系统存储，比如so文件

## 可重定位目标文件
text: 代码段

data：全局已初始化变量，常量

bss：全局未初始化变量

symtab: 符号表，存放程序定义和引用的函数和全局变量，部变量是放在栈上的，符号表不需要记录

rel.text rel.data: 引用外部模块代码和数据


## 符号解析
1. 静态链接

    静态库的好处：在连接时只会拷贝自己引用的函数和数据到目标文件，而重定位目标文件需要全量拷贝
    静态库是多个点o文件的集合，当链接时只会编译使用到的点o文件
    
1. 链接顺序

    在gcc编译链接时被引用的库放在引用库的后面

1. 重定位

    连接器的重定位就是把代码中的每个符号引用和确定的一个符号定定义联系起来；在目标模块时不知道数据和代码放在存储器什么位置，链接的作用就是通过重定位的决定引用来确定运行时的地址


## 共享库

    需要生成位置无关的代码，可以通过dlopen来动态加载代码，达到灵活控制的作用

    系统函数hook有三种方式：编译、链接、load和runtime
    编译：通过define
    link：通过wrap 编译参数替换
    runtime：动态链接，preload查找未解析引用
