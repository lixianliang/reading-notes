# 9

1. 所有计算的问题都可以通过抽象一层来解决

1. 共享代码 libc.so 在内存只有一份拷贝，比静态库更好；但目前容器时代可能优势不是很大了

1. 虚拟内存，只有在真正访问才会占用内存，这就在malloc了，不一定占用的内存的原因

1. 虚拟地址空间是48位

1. 多级页表空间
    节省内存


### fork的高效实现
    子进程拷贝父进程的虚拟地址空间；使用了copy on write的技术，在读的情况下两者的物理内存是一致性的；当有写入时，会引起子进程页表缺页异常，拷贝真正需要的数据


### 虚拟存储
   虚拟存储器是由系统自动提供的，它也是一种有限的存储器资源，作为程序员需要深入了解原理才能写高效果程序

### 虚拟存储器的作用
1. 主内存中自动缓存最近使用的存放在磁盘上的虚拟地址空间内容
2. 虚拟存储器简化了存储器管理，进而简化了链接和进程间的数据共享
3. 虚拟存储器通过在每条页表条目上加入保护位，从而保护了各进程间的安全性


## 动态内存的实现
### 内存碎片
    内存碎片：字节对齐
    外部碎片:  没有满足的空闲块

    free怎么知道块有多大： block size，返回有效负载p0, 一个word记录size和a（1；分配，0：free）4字节(64)
### 怎么寻找一个合适的空闲块进行内存分配
1. 首次适配: 估计利用率不好
1. 下次适配：记录最后适配的位置,内存碎片更多
1. 最佳适配: 扫描搜索时间多

### 如何跟踪空闲块
1. free: 前后块通过header footer关联，便于前后块合并
1. 多个空闲列表管理不同大小内存块

### 内存碎片优化
1. 应用可以使用内存池来减少系统的内存碎片

### 常用c常见的内存错误
1. 间接引用坏指针
1. 读未初始化的存储器
1. 缓冲区溢出
1. 数组越界
1. 指针运算错误
1. 引用不存在的变量（函数内部变量）
1. 应用空闲块的数据
1. 没有释放堆内存引起内存泄漏
